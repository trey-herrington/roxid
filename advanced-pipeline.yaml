name: advanced-pipeline
description: Demonstrates advanced pipeline features

env:
  PROJECT_NAME: roxid
  BUILD_ENV: development

steps:
  - name: Environment Info
    shell:
      script: |
        echo "Project: $PROJECT_NAME"
        echo "Environment: $BUILD_ENV"
        echo "OS: $(uname -s)"
        echo "Rust version: $(rustc --version)"
    
  - name: Clean build artifacts
    command: cargo clean
    continue_on_error: true
    
  - name: Update dependencies
    command: cargo update
    continue_on_error: true
    env:
      CARGO_NET_RETRY: "3"
    
  - name: Security audit
    command: cargo audit
    continue_on_error: true
    
  - name: Build workspace
    command: cargo build --workspace --all-features
    
  - name: Run unit tests
    command: cargo test --lib --all
    env:
      RUST_BACKTRACE: "1"
      RUST_TEST_THREADS: "2"
    
  - name: Check code coverage
    shell:
      script: |
        echo "Code coverage check would run here"
        echo "Example: cargo tarpaulin or cargo llvm-cov"
    continue_on_error: true
    
  - name: Build documentation
    command: cargo doc --workspace --no-deps --document-private-items
    continue_on_error: true
    
  - name: Success summary
    shell:
      script: |
        echo "========================================="
        echo "Pipeline completed successfully!"
        echo "========================================="
        echo "All critical steps passed."
        echo "Build artifacts available in target/"
