name: rust-build-pipeline
description: Complete Rust project build and test pipeline

env:
  RUST_BACKTRACE: "1"
  CARGO_TERM_COLOR: always

steps:
  - name: Check formatting
    command: cargo fmt --check
    continue_on_error: true

  - name: Run Clippy lints
    command: cargo clippy --all-targets --all-features -- -D warnings
    continue_on_error: true

  - name: Build all packages
    command: cargo build --all

  - name: Run tests
    command: cargo test --all
    env:
      RUST_TEST_THREADS: "4"

  - name: Generate documentation
    command: cargo doc --no-deps
    continue_on_error: true

  - name: Build release
    shell:
      script: |
        echo "Building optimized release..."
        cargo build --release --quiet
        echo "Release build complete!"
